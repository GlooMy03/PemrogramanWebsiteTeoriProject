<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mie Gacoan Menu</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/menuDETAIL_style.css">
    <style>
        .error-message {
            text-align: center;
            color: #ff0000;
            padding: 20px;
            font-size: 1.1em;
        }
        
        .menu-item-description {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
        
        .menuMKN-item {
            position: relative;
            background: #fff;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .menuMKN-item:hover {
            transform: translateY(-5px);
        }

        .menuMKN-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .menu-item-info {
            padding: 15px;
        }

        .menu-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .menu-item-title {
            font-weight: bold;
            font-size: 1.1em;
        }

        .menu-item-price {
            color: #e44d26;
            font-weight: bold;
        }

        .add-to-cart {
            background: #e44d26;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .add-to-cart:hover {
            background: #c73e1d;
        }

        .out-of-stock-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 0, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            font-size: 1.1em;
            color: #666;
        }
        .counter-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .counter-button {
            background: #e44d26;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: none;
            font-size: 16px;
            transition: background 0.3s ease;
        }

        .counter-button:hover {
            background: #c73e1d;
        }

        .counter-value {
            font-size: 16px;
            font-weight: bold;
            min-width: 30px;
            text-align: center;
        }

        .add-to-cart-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="menu-wrap">
            <a href="index.html" class="logo">
                <img src="assets/LogoMieGacoan-removebg-preview.png" alt="Mie Gacoan Logo">
            </a>
            <div class="menu">
              <a href="index.html" class="menu-item">Home</a>
              <a href="about.html" class="menu-item">About</a>
              <a href="menuUtama.html" class="menu-item active">Menu</a>
              <a href="order.html" class="menu-item">Order</a>
              <a href="contact.html" class="menu-item">Contact</a>
          </div>
            <div class="right-menu">
                <button id="loginBtn">Login</button>
                <button id="signUpBtn">Sign Up</button>
                <button id="profileBtn" style="display:none;">Profile</button>

            </div>
        </div>
    </nav>


  <section class="promo-section">
    <img src="assets/promo.png" class="promo1">
  </section>
  
    <!-- Menu Sections -->


    <!-- Menu Section -->
    <section class="menu-section">
        <div class="section-header">
            <h2>MIE GACOAN</h2>
        </div>
        <div class="menu-grid">
            <!-- Items will be loaded dynamically -->
            <div class="loading">Loading menu items...</div>
        </div>
    </section>
  

            <!-- Other -->
            <section class="other-section">
                <h2>OTHER</h2>
                <div class="other-grid">
                    <div class="other-card">
                        <h3>Paket Hemat</h3>
                        <a href="#" onclick="location.href='menuPktHmt.html';">View More</a>
                    </div>
                    <div class="other-card">
                        <h3>Mie Gacoan</h3>
                        <a href="#" onclick="location.href='menuMGcn.html';">View More</a>
                    </div>
                    <div class="other-card">
                        <h3>Mie Hompimpa</h3>
                        <a href="#"  onclick="location.href='menuMHmp.html';">View More</a>
                    </div>
                    <div class="other-card">
                        <h3>Dimsum</h3>
                        <a href="#" onclick="location.href='menuDmsm.html';">View More</a>
                    </div>
                </div>
            </section>
        

  <!-- Footer -->
  <footer>
      <div class="footer-content">
          <div class="footer-info">
              <div class="footer-logo">
                  <img src="assets/LogoMieGacoan-removebg-preview.png" alt="Mie Gacoan">
              </div>
              <p>In the new era of technology we look a in the future with certainty and pride for our company suit.</p>
              <div class="social-links">
                  <a href="#">Twitter</a>
                  <a href="#">Facebook</a>
                  <a href="#">Instagram</a>
                  <a href="#">Pinterest</a>
              </div>
          </div>
          <div class="footer-links">
              <h3>Pages</h3>
              <a href="homepage.html">Home</a>
              <a href="#">About</a>
              <a href="menu.html">Menu</a>
              <a href="#">Pricing</a>
              <a href="#">Blog</a>
          </div>
          <div class="footer-links">
              <h3>Utility Pages</h3>
              <a href="#">Start Here</a>
              <a href="#">Styleguide</a>
              <a href="#">Password Protected</a>
              <a href="#">404 Not Found</a>
              <a href="#">Licenses</a>
          </div>
      </div>
  </footer>
    <!-- Add cart notification element -->
    <div id="cart-notification" style="display: none; position: fixed; top: 20px; right: 20px; background: #4CAF50; color: white; padding: 15px; border-radius: 5px; z-index: 1000;"></div>

    <!-- JavaScript for menu functionality -->
    <script>
        // Fungsi untuk mengambil userId dari sessionStorage
        function getUserId() {
            return sessionStorage.getItem('userId'); // Pastikan 'userId' disimpan saat pengguna login
        }
    
        // Cek apakah pengguna sudah login
        function checkLoginStatus() {
            const user = sessionStorage.getItem('user'); // Cek di sessionStorage
        
            if (user) {
                // Jika pengguna sudah login, sembunyikan tombol login dan sign up, tampilkan tombol profile
                document.getElementById('loginBtn').style.display = 'none';
                document.getElementById('signUpBtn').style.display = 'none';
                document.getElementById('profileBtn').style.display = 'block';
                sessionStorage.setItem('isLoggedIn', true); // Set status login
            } else {
                // Jika pengguna belum login, tampilkan tombol login dan sign up
                document.getElementById('loginBtn').style.display = 'block';
                document.getElementById('signUpBtn').style.display = 'block';
                document.getElementById('profileBtn').style.display = 'none';
                sessionStorage.setItem('isLoggedIn', false); // Set status logout
            }
        }
    
        const apiUrl = 'http://localhost/PemrogramanWebsiteTeoriProject/BE/admin_menu.php';
    
        // Simpan status login pengguna
        const isLoggedIn = sessionStorage.getItem('isLoggedIn') === 'true'; // Pastikan login statusnya boolean
    
        // Objek untuk menyimpan jumlah item
        const itemCounters = {};
    
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('cart-notification');
            notification.textContent = message;
            notification.style.backgroundColor = type === 'success' ? '#4CAF50' : '#f44336';
            notification.style.display = 'block';
    
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
    
        function updateCounter(itemId, increment) {
            itemCounters[itemId] = (itemCounters[itemId] || 0) + increment;
            if (itemCounters[itemId] < 0) itemCounters[itemId] = 0;
    
            const counterElement = document.querySelector(`#counter-${itemId}`);
            if (counterElement) {
                counterElement.textContent = itemCounters[itemId];
            }
        }
    
        function addToCart(itemName, itemId) {
    const quantity = itemCounters[itemId] || 0;
    if (quantity > 0) {
        if (!isLoggedIn) {
            showNotification('Please login to add items to cart', 'error');
            return;
        }

        // Ambil ID customer dari session
        const idCustomer = getUserId();

        if (!idCustomer) {
            showNotification('User ID not found. Please log in again.', 'error');
            return;
        }

        // Ambil data item
        const itemData = getItemData(itemId); // Asumsikan ada fungsi untuk mendapatkan data item

        // Validasi harga dan gambar
        const price = itemData.price;
        const imageUrl = itemData.imageUrl || 'http://localhost/PemrogramanWebsiteTeoriProject/BE/uploadsMenu';
        if (!price || !itemData.name) {
            showNotification('Item data is incomplete. Cannot add to cart.', 'error');
            return;
        }

        // Kirim data ke server untuk disimpan di database
        fetch('http://localhost/PemrogramanWebsiteTeoriProject/BE/add_to_cart.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams({
                id_customer: idCustomer,
                id_menu: itemId,
                quantity: quantity,
                price: price
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                showNotification('Item added to cart in database');
            } else {
                showNotification(data.message || 'Failed to add item to database', 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('An error occurred while adding to the cart', 'error');
        });

        // Reset counter setelah menambah ke keranjang
        itemCounters[itemId] = 0;
        const counterElement = document.querySelector(`#counter-${itemId}`);
        if (counterElement) {
            counterElement.textContent = '0';
        }
    } else {
        showNotification('Please select quantity', 'error');
    }
}

    
function fetchAndDisplayMenuItems() {
    const menuGrid = document.querySelector('.menu-grid');
    menuGrid.innerHTML = '<div class="loading">Loading menu items...</div>';

    fetch(apiUrl)
        .then(response => {
            if (!response.ok) {
                throw new Error(`Network response was not ok: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            const items = data.filter(item => 
                item.kategori && item.kategori.toLowerCase() === 'mie gacoan'
            );

            menuGrid.innerHTML = ''; // Clear loading message

            if (items.length === 0) {
                menuGrid.innerHTML = '<div class="error-message">No items available at the moment.</div>';
                return;
            }

            items.forEach(item => {
                const menuItem = document.createElement('div');
                menuItem.className = 'menuMKN-item';

                const itemId = `item-${item.nama_menu.replace(/\s+/g, '-').toLowerCase()}`;
                const stockStatus = parseInt(item.stok) === 0
                    ? '<div class="out-of-stock-badge">Out of Stock</div>'
                    : '';

                menuItem.innerHTML = `
                    ${stockStatus}
                    <img src="../BE/uploadsMenu/${item.gambar}" alt="${item.nama_menu}" 
                        onerror="this.src='assets/default-beverage.jpg'">
                    <div class="menu-item-info">
                        <div class="menu-item-header">
                            <span class="menu-item-title">${item.nama_menu}</span>
                            <span class="menu-item-price">Rp ${parseFloat(item.harga).toLocaleString('id-ID')}</span>
                        </div>
                        ${item.deskripsi ? `<p class="menu-item-description">${item.deskripsi}</p>` : ''}
                        ${parseInt(item.stok) > 0 ? `
                            <div class="add-to-cart-container">
                                <form class="add-to-cart-form" onsubmit="submitCartForm(event, '${itemId}', '${item.nama_menu}', '${item.harga}')">
                                    <input type="hidden" name="id_customer" value="1">
                                    <input type="hidden" name="id_menu" value="${itemId}">
                                    
                                    
                                    <!-- Quantity Input -->
                                    <div class="counter-container">
                                        <label for="jumlah-${itemId}">Jumlah:</label>
                                        <input type="number" name="quantity" id="quantity-${itemId}" value="1" min="1" class="quantity-input">
                                        
                                    </div>

                                    <!-- Add to Cart Button -->
                                    <button type="submit" class="add-to-cart">Add to Cart</button>
                                </form>
                            </div>
                        ` : ''}
                    </div>
                `;

                menuGrid.appendChild(menuItem);
            });
        })
        .catch(error => {
            console.error('Error fetching menu items:', error);
            menuGrid.innerHTML = '<div class="error-message">Sorry, there was an error loading the menu.</div>';
        });
}

// Fungsi untuk menambah atau mengurangi jumlah item
function updateQuantity(itemId, delta) {
    const quantityInput = document.getElementById(`quantity-${itemId}`);
    let quantity = parseInt(quantityInput.value);
    if (isNaN(quantity)) {
        quantity = 0;
    }
    quantity += delta;

    if (quantity < 1) {
        quantity = 1; // Pastikan jumlah tidak kurang dari 1
    }

    quantityInput.value = quantity;
}

// Fungsi untuk mengirim form dan menambahkan item ke keranjang
function submitCartForm(event, itemId, itemName, itemPrice) {
    event.preventDefault();

    // const level = document.getElementById(`level-${itemId}`).value;
    const quantity = document.getElementById(`quantity-${itemId}`).value;

    const cartItem = {
        id_menu: itemId,
        name: itemName,
        price: parseFloat(itemPrice),
        quantity: parseInt(quantity),
        // level: level
    };

    console.log('Adding to cart:', cartItem);
    
    // Logic untuk menambahkan item ke keranjang
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    cart.push(cartItem);
    localStorage.setItem('cart', JSON.stringify(cart));

    alert(`${itemName} telah ditambahkan ke keranjang!`);
}



    
        // Inisialisasi ketika halaman dimuat
        document.addEventListener('DOMContentLoaded', () => {
            fetchAndDisplayMenuItems();
            checkLoginStatus();
        });
    </script>
    
    
</body>
</html>